---
title: "Whale Shark Observations: A Comprehensive Study"
author: "Evan Hadinata Ginting (33477558), Harsh Jain (33397058), Aishwarya Anil Kumar (32644329), Chih Hui Wang (33209006) and Shreyansh Mahtolia (33509115)"
format: 
  html:
    code-fold: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      eval = TRUE,
                      warning = FALSE,
                      message = FALSE)
```

```{r loadLibraries}
#| warning: false
#| message: false
#| eval: true
#| include: true
#| echo: false

library(tidyverse)
library(ggplot2)
library(here)
library(dplyr)
library(sf)
library(galah)
library(visdat)
library(leaflet)
library(rnoaa)
library(gridExtra)
library(rworldmap)
library(tsibble) # update #added
library(lubridate) # update #added
library(rmapshaper) # update #added
library(zoo) # update #added
library(tsibbletalk) # update #added
library(feasts) # update #added
library(plotly) # update #added
library(tibble) # update #added
library(forecast) # update #added
library(GGally) # update #added
```

## Introduction

::: {style="text-align: justify;"}
Whale Shark (Rhincodon typus) is the largest of all fishes alive. It may grow up to 18 metres (m) in length, but commonly seen between 4 m to 12 m. It is typically blue-grey or brownish in color with a pattern of white spots and vertical lines on its body. In terms of the diet, they feed on plankton, small crustaceans, squid, and fishes. The main feature of their food processing tools are their filtering screens on the gills and their tiny, more than 300 hooked teeth in both jaws. They are found on all the tropical oceans of the world where the water temperatures are ranging from 21 to 25 degrees Celsius and typically at depths of up to 1000 meters. Whale sharks are generally known to be active swimmers, and their activity can vary throughout the day and night. They do not exhibit diurnal (daytime) or seasonal (summer/winter) patterns of activity in the same way that some other species do. However, they seasonally come close to inshore areas, especially at plankton-rich locations. In Australia, it is found primarily in northern Western Australia, the Northern Territory, and Queensland. Whale sharks are known to migrate to the Ningaloo Marine park during specific times of the year, usually between March and July which is associated with the availability of plankton and other food sources in the area. During this time, there is usually a big ecotourism activity happening here for the chance to swim with them. Sadly, now, their status is an endangered species due to massive hunt of parts of their bodies. Hence, Conservation measures, including protections and regulations, are being implemented to safeguard this species in Australia and many other countries.

![Whale Shark](fig/jeremy-bishop-q9c4xqf80Y4-unsplash.jpg){#fig-whaleshark}
Photo by [Jeremy Bishop](https://unsplash.com/@jeremybishop?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash) on [Unsplash](https://unsplash.com/photos/black-whale-on-sea-q9c4xqf80Y4?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash)

In this study, We expect to encounter these events with our data analysis:

:::{.callout-note}
# Expectations

-   We expect to observe seasonal patterns in whale shark sightings, with higher occurrences during winter months.
-   We expect to see differences in the frequency of sightings between coastal areas and open ocean regions, indicating habitat preferences.
-   We expect to observe declining occurrences up to this year (2023).
-   We anticipate the sharks tend to move from east to west during fall and west to east during summer.
-   We expect to spot the most occurrences in the northern Western Australia.

:::

## Data description

### Whale-shark Data

This dataset contains the information about the occurrence of Whale Shark (Rhincodon Typus) in Australia at a certain time and place. The data is retrieved from the [Atlas of Living Australia (ALA) Website](https://www.ala.org.au/). ALA is a collaborative, digital, open infrastructure that pulls together Australian biodiversity data from multiple sources, making it accessible and reusable.

```{r loadData}
#| warning: false
#| message: false
#| eval: true
#| echo: false

# Extracting the occurrence data from ALA Website
galah_config(email = "egin0003@student.monash.edu")
ws_raw <- galah_call() |>
  galah_identify("Rhincodon typus") |>
  atlas_occurrences()

# Saving the raw data
save(ws_raw, file = here::here("data-raw/ws_raw.rda")) 
```

The data is located in folder `data-raw` named as `ws_raw.rda`. It contains these variables:

| Variables        | Description                                                                                                                                                                                     |
|------------------------------------|------------------------------------|
| decimalLongitude | The geographic longitude (in decimal degrees) of the geographic center of a Location.                                                                                                           |
| decimalLatitude  | The geographic latitude (in decimal degrees) of the geographic center of a Location.                                                                                                            |
| eventDate        | The date-time or interval during which an Event occurred. For occurrences, this is the date-time when the event was recorded. Not suitable for a time in a geological context.                  |
| scientificName   | The full scientific name, with authorship and date information if known. When forming part of an Identification, this should be the name in lowest level taxonomic rank that can be determined. |
| taxonConceptID   | The ID in an external taxonomic database, like a sequence reference database for example.                                                                                                       |
| recordID         | The ID of the occurrence.                                                                                                                                                                       |
| dataResourceName | The name identifying the data set from which the record was derived.                                                                                                                            |
| occurrenceStatus | A statement about the presence or absence of a Taxon at a Location.                                                                                                                             |

```{r wildOccurrences}
#| warning: false
#| message: false
#| eval: true
#| echo: false

# Extracting the assertion data from ALA Website 
ws_assert <- galah_call() |>
  galah_identify("Rhincodon typus") |>
  galah_select(group = "assertions") |>
  atlas_occurrences()

# Saving the assertion data
save(ws_raw, file = here::here("data-raw/ws_assertion.rda"))


# Extracting the event data from ALA Website
ws_event <- galah_call() |>
  galah_identify("Rhincodon typus") |>
  galah_select(group = "event") |>
  atlas_occurrences()

# Saving the event data
save(ws_raw, file = here::here("data-raw/ws_event.rda"))
```

Additionally, for data quality check, we also populate the `assertion` and `events` dataset, but ended up only using assertion. The reason for this will be explained in the **General Check** section.

### Weather stations data

The dataset contains the information about Weather station locations which can be found in a Global Historical Climatology Network (GHCN) database maintained by the National Oceanic and Atmospheric Administration. This data is downloaded using the rnoaa package.

```{r}
#| warning: false
#| message: false
#| eval: true
#| echo: false

# Populating Australian Station from NOAA
aus_stations <- ghcnd_stations() |>
  filter(str_starts(id, "ASN")) |>
  filter(last_year >= 2020) |>
  mutate(wmo_id = as.numeric(wmo_id),
         name = str_to_lower(name)) |>
  select(-state, -gsn_flag) |>
  filter(element %in% c("PRCP", "TMAX", "TMIN")) |>
  nest(element: last_year) |>
  rowwise() |>
  filter(nrow(data) == 3) |>
  select(-data) 
```

| Variables | Description                                                                         |
|------------------------------------|------------------------------------|
| id        | An identifier associated with a specific station.                                   |
| latitude  | The latitude (in decimal degrees) of the station's location.                        |
| longitude | The longitude (in decimal degrees) of the station's location.                       |
| elevation | The elevation (in meters) of the station's location.                                |
| name      | The name or description of the station.                                             |
| wmo_id    | The World Meteorological Organization (WMO) identifier associated with the station. |


### Downloading weather data from the nearest weather station

This dataset contains the information about the weather(Precipitation, Minimum and Maximum temperature) recorded by the selected station.

```{r}
#| warning: false
#| message: false
#| eval: true
#| echo: false

narrogin <- aus_stations |>
  filter(id == "ASN00005007") |>
  rowwise() |>
  mutate(ts = list(meteo_pull_monitors(
    monitors = id, var = c("PRCP", "TMAX", "TMIN"),
    date_min = "2004-01-01",
    date_max = "2023-09-13") |>
      select(-id))) |>
  rename(lat = latitude, long = longitude, elev = elevation) |> select(id, long, lat, elev, name, wmo_id, ts) %>%
  unnest(ts) |>
  mutate(tmax = tmax/10, tmin = tmin/ 10)
```

| Variables | Description                                                                          |
|------------------------------------|------------------------------------|
| id        | An identifier associated with a specific location or station.                        |
| long      | The longitude (in decimal degrees) of the location.                                  |
| lat       | The latitude (in decimal degrees) of the location.                                   |
| elev      | The elevation (in meters) of the location.                                           |
| name      | The name or description of the location or station.                                  |
| wmo_id    | The World Meteorological Organization (WMO) identifier associated with the location. |
| date      | The date of the recorded weather data.                                               |
| prcp      | Precipitation amount.                                                                |
| tmax      | Maximum temperature.                                                                 |
| tmin      | Minimum temperature.                                                                 |

## Downloading and processing the Australia domestic tourism dataset

This dataset, named "Tourism Research Australia online for students", is sourced from the Monash A-Z Database. It contains records of domestic travel within Australia, including quarterly data, regional information, trip purposes, and corresponding trip statistics. 

```{r}
#| warning: false
#| message: false
#| eval: true
#| echo: false

# Data downloaded from Monash A-Z Databases
# "Tourism Research Australia online for students"
# Row: Quarter/SA2
# Column: Stopover reason was Holiday, Visiting friends and relatives, Business, Other reason
# Sum Overnight trips ('000)
# Australia: Domestic Overnight Trips ('000) ----

domestic_trips <- read_csv(
  "data/domestic_trips_2023-10-08.csv",
  skip = 9,
  col_names = c("Quarter", "Region", "Holiday", "Visiting", "Business", "Other", "Total"),
  n_max = 248056
) %>% select(-X8)

# fill NA in "Quarter" using the last obs
fill_na <- domestic_trips %>%
  fill(Quarter, .direction = "down") %>%
  filter(Quarter != "Total")

# gather Stopover purpose of visit
long_data <- fill_na %>%
  pivot_longer(cols=Holiday:Total,
               names_to="Purpose",
               values_to="Trips")

# manipulate Quarter
qtr_data <- long_data %>%
  mutate(
    Quarter = paste(gsub(" quarter", "", Quarter), "01"),
    Quarter = yearquarter(myd(Quarter))
  )

# convert to tsibble
tourism <- qtr_data %>%
  as_tsibble(key = c(Region, Purpose), index = Quarter)
# usethis::use_data(tourism, overwrite = TRUE, compress = "xz") Commented due to error
```

| Variables | Description                                                                          |
|------------------------------------|------------------------------------|
| Quarter   | Quarterly information, representing each quarter within a year.                      |
| Region    | Records of various regions or cities within Australia.                               |
| Purpose   | The purpose of the trip contains holiday, visiting, business and other.              |
| Trips     | The number of trips ('000).                                                          |

## Initial data analysis (IDA)

### Data Quality Check

#### General Check

-   There are `r ws_raw$dataResourceName %>% n_distinct()` different data sources (based on `dataResourceName`). Upon referring to their data collection method on atlas website, it is evident that all the sightings are wild sightings.

-   `ws_event` data has the `samplingProtocol` variable which basically indicates what type of sighting or data collection method was used. Most of the values are missing for this variable, so we decided that it is not a reliable dataset to identify the type of wild sightings.

-   From `ws_assert` (assertion) data, we refer our check to the `BASIS_OF_RECORD_INVALID` column, which provide information if the occurrences are valid or invalid. Currently, there are `r ws_assert %>% filter(BASIS_OF_RECORD_INVALID == "TRUE") %>% nrow()` values recorded as TRUE indicating that they are invalid records. These invalid records will be removed to ensure the quality of the data.

#### Data Type Check

For the occurrences dataset, we are going to perform data type check, as specified below:

```{r IDA}
#| label: fig-visdat
#| fig-cap: "Checking Data Types"
#| fig-width: 10
#| fig-heigth: 8
#| echo: false
#| warning: false
#| message: false

vis_dat(ws_raw)
# Checking data types and replacing them with correct data types
ws_raw <- ws_raw %>%
  mutate(
    decimalLatitude = as.numeric(decimalLatitude),
    decimalLongitude = as.numeric(decimalLongitude),
    eventDate = as.Date(eventDate)
  )
```

From the @fig-visdat above, we can see:

-   The classes for all the variables in the ws_raw data set are correct except for `eventDate` which needs to be of Date type and only include dates.

-   There are few missing values for `decimalLatitude` and `decimalLongitude` . We can also see that if `decimalLatitude` is missing, `decimalLongitude` is also missing and vice-versa.

-   There are `r ws_raw %>% filter(is.na(eventDate)) %>% nrow()` missing values in the `eventDate` variable out of `r ws_raw %>% nrow()` records.

<!--

#### Outliers Check

**Checking `eventDate` variables:**

```{r IDA2}
#| label: fig-boxplot
#| fig-cap: "Profile of Yearly Occurrences"
#| fig-width: 5
#| fig-heigth: 5
#| echo: false
#| warning: false
#| message: false

ws_raw %>% 
  filter(!is.na(eventDate)) %>% 
  ggplot(aes(y = year(eventDate))) + 
  geom_boxplot() +
  ggtitle(label = "Profile of Yearly Occurrences") +
  xlab("Number of Occurrences") +
  ylab("Year") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
```

Based on @fig-boxplot:

-   There are only few outlier years out of which the year below 1980 is farthest from the population.

-   There are `r ws_raw %>% filter(year(eventDate) < 1990) %>% nrow()` rows with record year less than 1990 which will be removed as they are not really reliable.

-   The other outliers might have some valid information since they follow natural order so we won't be excluding them in clean data.

-->

**Checking Location of Occurrences**

```{r IDA3}
#| label: fig-alloccu
#| fig-cap: "All Occurrences"
#| fig-width: 8
#| fig-heigth: 8
#| echo: false
#| warning: false
#| message: false
#| eval: true

wmap <- rworldmap::getMap(resolution = "low")  %>% # this is SpatialPolygonDataFrame
          st_as_sf()

ggplot() +
  geom_sf(data = wmap) +
  #ylim(-45, -5) +
  #xlim(110, 155) +
  geom_point(data = ws_raw, aes(x = decimalLongitude, y = decimalLatitude), color = "red3") +
  ggtitle(label = "Location of All Whale Sharks Occurrences",
          subtitle = "Data Period: 1993 - 2023") +
  xlab("Longitude") +
  ylab("Latitude") +
  theme_classic() +
  theme(plot.title = element_text(face = "bold"),
        plot.subtitle = element_text(hjust=0.4, face = "italic", size = 10))
```

-   When plotting the locations of whale shark spotting, it is evident that some instances are from around the world and not just Australian waters.

```{r}
#| label: fig-auoccurr
#| fig-cap: "Occurrences over Australia"
#| fig-width: 8
#| fig-heigth: 8
#| echo: false
#| warning: false
#| message: false
#| eval: true

ggplot() +
  geom_sf(data = wmap %>% filter(NAME == "Australia")) +
  ylim(-45, -5) +
  xlim(110, 155) +
  geom_point(data = ws_raw, aes(x = decimalLongitude, y = decimalLatitude), color = "red3") +
  ggtitle(label = "Location of All Whale Sharks Occurrences",
          subtitle = "Data Period: 1993 - 2023") +
  xlab("Longitude") +
  ylab("Latitude") +
  theme_classic() +
  theme(plot.title = element_text(face = "bold"),
        plot.subtitle = element_text(hjust=0.4, face = "italic", size = 10))
```

-   Later we will filter the location to only include sightings around Australia only.

### Finding nearest weather station

In plotting the map, here we employ the usage of geospatial object of Australia, known as Geocentric Datum of Australia 2020 (GDA2020) that is provided by Australian Bureau of Statistics [here](https://www.abs.gov.au/statistics/standards/australian-statistical-geography-standard-asgs-edition-3/jul2021-jun2026/access-and-downloads/digital-boundary-files). By using this, we are able to plot the map of Australia with separation line of Australian Federal State (e.g. Victoria, New South Wales, Queensland, Western Australia, etc.), which later help us identify the nearest weather station.

**First of all**, we plot all weather station recently active in Australia.

```{r}
#| label: fig-allstation
#| fig-cap: "All Weather Station"
#| fig-width: 8
#| fig-heigth: 8
#| echo: false
#| warning: false
#| message: false

# Loading AU Map
states <- read_sf(here::here('data/STE_2021_AUST_SHP_GDA2020/STE_2021_AUST_GDA2020.shp'))

# Plotting All Weather Station
ggplot() +
  geom_sf(data = states) +
  ylim(-45, -5) +
  xlim(110, 155) +
  geom_point(data = aus_stations, aes(x = longitude, y = latitude), color = "red3") +
  ggtitle(label = "Location of Weather Station over Australia",
            subtitle = "Data Source: NOAA") +
  xlab("Longitude") +
  ylab("Latitude") +
  theme_classic() +
  theme(plot.title = element_text(face = "bold"),
        plot.subtitle = element_text(hjust=0.4, face = "italic", size = 10))
```

Secondly, we plot the weather station that is closest to the site with most occurrences of whale sharks, which in this case is **Learmonth Airport Weather Station**. Since we already have the site with the highest occurrences that is the Ningaloo reef, we were able to find the weather station using [this website](https://www.honeymoonguide.com.au/australia/ningaloo-reef-weather.html#:~:text=Note%3A%20Meteorological%20data%20for%20the%20Ningaloo%20Coast%20is).

```{r}
#| label: fig-nearstation
#| fig-cap: "Nearest Weather Station"
#| fig-width: 8
#| fig-heigth: 8
#| echo: false
#| warning: false
#| message: false

# Nearest Station
ggplot() +
  geom_sf(data = states) +
  ylim(-45, -5) +
  xlim(110, 155) +
  geom_point(data = (aus_stations %>% filter(name == "learmonth airport")), aes(x = longitude, y = latitude), color = "red3") +
  ggtitle(label = "Location of Nearest Weather Station of the Most Occurrences",
            subtitle = "Data Source: NOAA") +
  xlab("Longitude") +
  ylab("Latitude") +
  theme_classic() +
  theme(plot.title = element_text(hjust=0.5, face = "bold"),
        plot.subtitle = element_text(hjust=0.5, face = "italic", size = 10))
```



### Data Cleansing and Transforming

In this section, before we go into the data analysis adventure we perform a bit of data cleansing and transforming. This is important to make sure we maintain the quality of the data.

**Whale Shark data**

The following code was used to clean the Whale Shark Data.
```{r}
#| echo: true
#| warning: false
#| message: false
#| eval: true

# Getting Invalid Record
ws_assert <- ws_assert %>%
  select(recordID, BASIS_OF_RECORD_INVALID)

# Joining Raw Occurrence data to Assert data to filter out the invalid records
# Performing further data cleansing & manipulating
whale_shark <- ws_raw %>%
                left_join(ws_assert, by = "recordID") %>% #1281 rows
                filter(BASIS_OF_RECORD_INVALID == FALSE, #1249 rows
                       is.na(eventDate) | year(eventDate) > 1990, #1247 rows
                       is.na(decimalLatitude) == FALSE) %>% #1241 rows
                mutate(season = case_when(month(eventDate) %in% c(12, 1, 2) ~ 'Summer',
                                          month(eventDate) %in% c(3, 4, 5) ~ 'Fall',
                                          month(eventDate) %in% c(6, 7, 8) ~ 'Winter',
                                          month(eventDate) %in% c(9, 10, 11) ~ 'Spring',
                                          TRUE ~ NA))
                       
# Removing unnecessary columns from data
whale_shark <- whale_shark %>% select(-4, -5, -7, -8, -9)


# Saving into RDA file
save(whale_shark, file = "data/whale_shark.rda")
```

In the code above, we have performed some steps of data cleansing, which include: 
- Join the occurrence data to assertion data by `recordID` variable. 

- Taking the `BASIS_OF_RECORD_INVALID` into the occurrence data and filter out the invalid records by setting the variable value into "False". 

- Filter out the occurrences that happened before 1990 as they are unreliable. 

- Filter out the occurrences that has missing value in `decimalLatitude`. 

- Add a new variable as identifier. Variable `season`, is an identifier for season (e.g. Summer, Fall, Winter, and Spring). These two columns are needed to perform the plot for our expectations.

**Weather Data**

Filtering out the variables that we don't need for our analysis using select query.

```{r}
#| echo: true
#| warning: false
#| message: false
#| eval: true

narrogin_v2 <- narrogin %>%
                select(date, prcp, tmax, tmin)
```

### Joining Whale Shark Data & Weather Data

Here is the code that we use to join the whale shark data to weather station data. Basically, we join them based on the `eventDate` and `date`, because we want to analyse how was the weather condition for every sightings that was recorded.

```{r}
whale_shark_weather <- whale_shark %>%
                         # Filter occurrence to near learmonth weather station
                         filter(decimalLatitude < -20, decimalLatitude > -24,
                                decimalLongitude > 112, decimalLongitude < 115) %>%
                         left_join(narrogin_v2, by = c("eventDate" = "date")) %>%
                         mutate(sighting = ifelse(is.na(tmin) & is.na(tmax), 0, 1))

# Saving into RDA file
save(whale_shark_weather, file = "data/whale_shark_weather.rda")
```

### Why Labeling Days When Sighting Occurs is Necessary?

-   So, we're trying to figure out how weather conditions relate to wildlife sightings, specifically with whale sharks. We've got two main datasets: one with daily weather data from NOAA weather stations, and another with records of when and where whale shark sightings occurred.

-   Weather data is collected every day, like clockwork, but whale shark sightings don't happen every day. So, to connect the dots and see how weather affects sightings, we need a way to match up the weather conditions with whether a sighting happened on that day.

-   That's where this "sighting occurred" or "didn't occur" label comes in. Basically, we're creating a new variable that says "1" if there was a whale shark sighting on a particular day and "0" if there wasn't.

-   This is all about making our data analysis easier. With these labels, we can do things like calculate correlations between weather factors (precipitation, temperature) and sightings. We can test hypotheses like, "Do sightings increase when there are higher chances of rain?" or "Are sightings more likely in certain temperature ranges?"

-   Plus, when we visualise the data, it's much clearer. We can make time series plots that show how weather conditions and sightings line up over time. And if we want to build models that predict when whale sharks might appear based on weather forecasts, these labels are essential.

**Tourism Data**

Before we can combine the joined weather and sighting dataset, we must first convert `the whale_shark_weather.rda` into a sf object which is then joined with the tourism dataset. 

```{r}
#| echo: true
#| warning: false
#| message: false
#| eval: true

# Convert Sighting data to a sf object
whale_shark_sf <- whale_shark_weather |>
  select(-c(recordID)) |>
  st_as_sf(coords = c("decimalLongitude", "decimalLatitude"),
  crs = st_crs("WGS84"))
```

### Joining Combined Whale Shark Data & Weather Data With Tourism Data

Below is the code to combine both the whale_weather data with the tourism data. The merging of the datasets is done by 

```{r}
#| echo: true
#| warning: false
#| message: false
#| eval: true


t_region <- st_read(here::here("data/SA2_2021_AUST_SHP_GDA2020/SA2_2021_AUST_GDA2020.shp")) |>
  ms_simplify(keep = 0.1) |>
  st_transform(crs = st_crs("WGS84")) |>
  st_make_valid() |>
  select(STE_NAME21, SA2_NAME21, SA2_CODE21, geometry) |>
  rename("state" = STE_NAME21,
         "region" = SA2_NAME21,
         "sa2_code21" = SA2_CODE21)


# Join
# some points are out of the polygon, lets filter out so we get only points in the polygon
pt_sf <-
  st_join(t_region, whale_shark_sf, left = TRUE) %>%  # spatial join to get intersection of points and poly
  filter(!is.na(region)) # get only the points (sightings) that fall in the polygon (tourism region)
```

From the plot above showing all tourist spots, we chose the tourist spot which contains the weather station which is **Learmonth Airport Weather Station**, and the sightings with the most occurrences of whale sharks which in this case is **Exmouth** which we were able to figure out by.... We also filtered out the Purpose of tourism with 'Total' since we it will just overlap the other purposes and provide inaccurate results while analyzing the results.

```{r}
#| echo: true
#| warning: false
#| message: false
#| eval: true

# Aggregate by Region, Year
pt_sf_region <- left_join(
  t_region |> select(region, geometry),
  pt_sf |>
    as_tibble() |>
    group_by(region) |>
    summarise(sighting = n()),
  by = c("region" = "region")
)

tourism_quarterly <- tourism %>%  group_by_key() %>%
  index_by(year_quarter = Quarter) %>% # quarterly aggregates
  summarise(
    total_trips = sum(Trips, na.rm = TRUE)
  )
#taking the highest sighting region
max_sighting <- pt_sf_region %>% filter(sighting == 120)


highest_sightings <- tourism_quarterly %>% filter(Region == 'Exmouth' & Purpose != 'Total')

polygon_geometry <- st_geometry(max_sighting)[1]  #Getting Latitude & Longitude for Exmouth

coordinates <- st_coordinates(polygon_geometry) |>
  as_tibble()


states %>%
  ggplot() +
  geom_sf(aes(geometry = geometry)) + #Showing Tourist Region for Subset Weather Station & Sightings
  geom_point(data = coordinates, aes(x=X,y=Y), color = "red", size = 0.1)  +
  ggtitle(label = "Area of Tourist Destination In Accordance To Weather Station",
            subtitle = "Location: Exmouth") +
  xlab("Longitude") +
  ylab("Latitude") +
  theme_classic() +
  theme(plot.title = element_text(hjust=0.5, face = "bold"),
        plot.subtitle = element_text(hjust=0.5, face = "italic", size = 10)) 

```


## Exploratory Data Analysis (EDA)

This is the part where we start our data analysis journey. In general, we are trying to prove our expectations that we have stated in the previous section. We will cover the method that we use, additional dataset that we employed, and uncover the insights that we gather from the analysis. Additional to the proving the expectations, we want to comprehend the study by utilising the weather station, where we are going to perform some correlation analysis between the whale shark sightings towards the weather condition of the local area.

### Expectation 1: We expect to observe seasonal patterns in whale shark sightings, with higher occurrences during winter months.

The @fig-countoccur below depict the number of occurrence for every season from 1993 until 2023.

```{r}
#| label: fig-countoccur
#| fig-cap: "Number of Occurrences per Season"
#| fig-width: 8
#| fig-heigth: 8
#| echo: false
#| warning: false
#| message: false

whale_shark %>%
  filter(is.na(eventDate) == FALSE) %>%
  group_by(season) %>%
  summarise(count = n()) %>%
  ggplot(aes(x = fct_reorder(season, -count), y = count)) +
    geom_bar(stat = "identity", position = "dodge", fill = "skyblue") +
    geom_text(aes(label = count, x = season, y = count),
                              position = position_dodge(width = 0.9),
                              vjust = 1.5,
                              hjust = 0.5,
                              size = 4) +
    ggtitle(label = "Number of Occurrences per Season",
            subtitle = "Data Period: 1993 - 2023") +
    xlab("Season") +
    ylab("Count of Occurrences") +
    theme_classic() +
    theme(plot.title = element_text(hjust=0.5, face = "bold"),
          plot.subtitle = element_text(hjust=0.5, face = "italic", size = 10))
   
```

<div style="background-color: #FFFFCC; padding: 10px;">
-   Based on the plot above, it seems that __winter indeed had a substantial number of sightings (319), which closely align with our expectation__. Spring had a slightly higher number of sightings (322) than winter, but even though this contradicts with our initial expectation, it is important to note that the difference between spring and winter is relatively small. The other two season, Fall and Summer, clearly has less occurrences, with 258 and 98 sightings, respectively.

-   Although our initial expectation was to observe higher occurrences during the winter months, the data shows that sightings were relatively evenly distributed between spring and winter, with spring has slightly more occurrences. Additionally, fall had a significant number of sightings, while summer had the fewest.
</div>

### Expectation 2: We expect to see differences in the frequency of sightings between coastal areas and open ocean regions, indicating habitat preferences.

For this expectation, we use 2 geospatial objects about territorial sea boundary and exclusive economic zone of Australia. These maps have been derived from Geoscience Australia's Australian Maritime Boundaries (AMB) version 2.0 data which is a digital representation of Australia's territorial sea baseline and the maritime limits and boundaries as established under the Sea and Submerged Lands Act 1973. The map describes the different maritime zones, explains how Australia defines and updates its maritime boundaries, and lists the different maritime boundary arrangements with Indonesia, Papua New Guinea, Solomon Islands, France (New Calendonia and Kerguelen) and New Zealand. Their gdb file can be found [here](https://ecat.ga.gov.au/geonetwork/srv/eng/catalog.search#/metadata/63690). Since our expectation requires coastline and open ocean region for Australia, we have used these boundary files.

```{r}
#| label: fig-coastalboundary
#| fig-cap: "Coastal Boundary"
#| fig-width: 8
#| fig-heigth: 8
#| echo: false
#| warning: false
#| message: false
#| quiet: true

# Checking Layers of the GDB file to figure out which files we require for our boundaries.
st_layers(
  "data/Maritime_Boundaries_Database/Seas and Submerged Lands Act 1973/Seas and Submerged Lands Act 1973.gdb"
)

open_ocean_boundary <-
  st_read(
    "data/Maritime_Boundaries_Database/Seas and Submerged Lands Act 1973/Seas and Submerged Lands Act 1973.gdb",
    layer = "Exclusive_Economic_Zone_AMB2014a_Area",
    quiet = TRUE
  )

coastal_boundary <-
  st_read(
    "data/Maritime_Boundaries_Database/Seas and Submerged Lands Act 1973/Seas and Submerged Lands Act 1973.gdb",
    layer = "Territorial_Sea_AMB2014a_Area",
    quiet = TRUE
  )

points_sf1 <-
  st_as_sf(
    whale_shark,
    coords = c("decimalLongitude", "decimalLatitude"),
    crs = st_crs(open_ocean_boundary)
  )
sf_use_s2(FALSE)
points_sf2 <-
  st_as_sf(
    whale_shark,
    coords = c("decimalLongitude", "decimalLatitude"),
    crs = st_crs(coastal_boundary)
  )

points_within_coast <- st_intersection(points_sf2, coastal_boundary)
points_within_ocean <- st_intersection(points_sf1, open_ocean_boundary)

ggplot() +
  geom_sf(data = coastal_boundary) +
  geom_sf(data = points_within_coast,
          color = "red",
          size = 1) +
  geom_sf(data = points_within_ocean,
          color = "blue",
          size = 1) +
  ylim(-45,-5) +
  xlim(110, 155) +
  ggtitle(label = "Coastal vs Open Ocean Sightings",
            subtitle = "Data Period: 1993 - 2023") +
  xlab("Longitude") +
  ylab("Latitude") +
  theme_classic() +
  theme(plot.title = element_text(hjust=0.5, face = "bold"),
        plot.subtitle = element_text(hjust=0.5, face = "italic", size = 10))
```

<div style="background-color: #FFFFCC; padding: 10px;">
-   As we can see from the map above, __there are very few observations in the open ocean area and majority of the wild sightings have been in the coastal area__ indicated by red dots.

-   Since the Geoscience Australia considers coastal waters different from territorial sea (coastal boundary), some of the points which are in the coastal waters are excluded from the plot. Also, shape file for coastal waters is not available which doesn't allow us to plot them on the map.

-   So, we can say that our expectation has been met and the chances that whale sharks appear in the coastal area is higher than the open ocean region of Australia.
</div>

### Expectation 3: We expect to observe declining occurrences up to this year (2023).

```{r}
#| label: fig-occurtrend
#| fig-cap: "Whale Shark sightings every year"
#| fig-width: 8
#| fig-heigth: 8
#| echo: false
#| warning: false
#| message: false

whale_shark %>%
  na.omit() %>%
  group_by(Year = year(eventDate)) %>%
  summarise(Sightings = n_distinct(recordID)) %>%
  ggplot(aes(x = Year, y = Sightings)) +
  geom_line(size = 1, color = "skyblue") +
  geom_point(size = 3, color = "navy") +
  geom_text(aes(label = ifelse(
    Sightings > 150,
    paste("Year: ", Year, "\nSharks: ",
          as.character(Sightings)),
    ""
  )),
  hjust = 0, vjust = 1) +
  ggtitle(label = "Whale Shark Sightings per Year",
            subtitle = "Data Period: 1993 - 2023") +
  xlab("Year") +
  ylab("Observations") +
  theme_classic() +
  theme(plot.title = element_text(hjust=0.5, face = "bold"),
        plot.subtitle = element_text(hjust=0.5, face = "italic", size = 10))
```

<div style="background-color: #FFFFCC; padding: 10px;">
-   The plot suggests that there was a __notable increase in whale shark sightings from around 2008 to 2013, with the highest number of sightings occurring in 2013__. This period might represent a __peak in whale shark observations__.

-   After the peak, __there is a decline in sightings, but the decline stabilizes after 2017__. The number of sightings remains relatively consistent from 2018 to 2023, without a clear trend of continuous decline.

-   While __there may be fluctuations in the number of sightings from year to year, the data does not show a significant decline in occurrences up to the year 2023__. It suggests that the population of whale sharks in the observed area may have stabilized or reached a plateau, at least within the scope of the available data.

-   The expectation is not met according to the data.
</div>

> **Note:** This interpretation is based on the available data and the assumption that the observations are representative of the entire whale shark population in the area. Factors such as changes in survey effort or environmental conditions may also influence the observed trends.

### Expectation 4: We anticipate the sharks tend to move from east to west during fall and west to east during summer.

```{r}
#| label: fig-eastwest
#| fig-cap: "Sightings East v/s West season wise"
#| fig-width: 10
#| fig-heigth: 8
#| echo: false
#| warning: false
#| message: false

whale_shark %>% na.omit() %>%
  mutate(Direction = ifelse(decimalLongitude <
                              134, "West", "East")) %>%
  group_by(season, Direction, year(eventDate)) %>%
  summarise(sum = n_distinct(recordID)) %>%
  ggplot(aes(x = season, y = sum)) +
  geom_col() +
  facet_grid( ~ Direction) +
  coord_flip() +
  ggtitle(label = "Sightings Eastern Part v/s Western Part season wise",
            subtitle = "Data Period: 1993 - 2023") +
  xlab("Seasons") +
  ylab("Sightings") +
  theme_classic() +
  theme(plot.title = element_text(hjust=0.5, face = "bold"),
        plot.subtitle = element_text(hjust=0.5, face = "italic", size = 10))
```

<div style="background-color: #FFFFCC; padding: 10px;">

-   __Whale sharks generally prefer Western Australian waters more than Eastern waters__.

-   They also __prefer winter months over summer months in West whereas other way round in the East__.

-   This might suggest (if we get more data about the sharks in east), Sharks travel from west to east to enjoy summer months in east and east to west to enjoy winter months in west.

</div>

> **Note:** Here, 134 degrees longitude is used as reference line to separate the East from West since it equally divides the continents in two halves.

### Expectation 5: We expect to spot the most occurrences in the northern Western Australia.

The figure @fig-aumap below shows the sightings of whale shark.

```{r}
#| label: fig-aumap
#| fig-cap: "Locations of Where Sightings are Recorded in Australia"
#| fig-width: 8
#| fig-heigth: 8
#| echo: false
#| warning: false
#| message: false

# Plotting the Map
ggplot() +
  geom_sf(data = states) +
  ylim(-45, -5) +
  xlim(110, 155) +
  geom_count(data = whale_shark, aes(x = decimalLongitude, y = decimalLatitude, color = season)) +
  ggtitle(label = "Location of Sightings over Australia",
            subtitle = "Data Period: 1993 - 2023") +
  xlab("Longitude") +
  ylab("Latitude") +
  theme_classic() +
  theme(plot.title = element_text(face = "bold"),
        plot.subtitle = element_text(hjust=0.4, face = "italic", size = 10))
```

<div style="background-color: #FFFFCC; padding: 10px;">

-  From the map plot, it's evident that __whale shark sightings predominantly span the western, northern, and eastern coasts of Australia, with a notable concentration in Northern Western Australia__. The use of varying circle sizes helps represent multiple sightings at identical latitude and longitude, preventing overlap and offering a clearer representation. The __lesser number of sightings in southern Australia suggests a possible preference of the whale sharks for warmer waters, given the region's proximity to the colder southern pole__. 
-  While current data doesn't provide insights into sea water temperatures, such information could offer a more in-depth understanding of their behavior. Nevertheless, __the substantial number of sightings in Northern Western Australia aligns with existing knowledge, as whale sharks often migrate to areas like the *Ningaloo Marine Park*__.  -  Additionally, the __prevalence of eco-tourism in these regions likely boosts the recorded sightings__ due to a higher human presence during specific seasons.

</div>

### Whale Sharks Sightings against Weather Condition

```{r}
#| label: fig-learmonth
#| fig-cap: "Locations of Where Sightings are Recorded Near Learmonth Airport Weather Station"
#| fig-width: 8
#| fig-heigth: 8
#| warning: false
#| message: false
#| echo: false

ggplot() +
  geom_sf(data = states) +
  ylim(-23.5, -21) +
  xlim(112.5, 115.5) +
  geom_count(data = whale_shark_weather, aes(x = decimalLongitude, y = decimalLatitude, color = season)) +
  geom_point(data = (aus_stations %>% filter(name == "learmonth airport")), aes(x = longitude, y = latitude, label = name)) +
  geom_label(data = (aus_stations %>% filter(name == "learmonth airport")), aes(label = name, x = longitude, y = latitude),
                              position = position_dodge(width = 0.9),
                              vjust = 0.5,
                              hjust = -0.05,
                              size = 4) +
  ggtitle(label = "Location of Sightings near Learmonth Airport Weather Station",
            subtitle = "Data Period: 1993 - 2023") +
  xlab("Longitude") +
  ylab("Latitude") +
  theme_classic() +
  theme(plot.title = element_text(hjust=0.4, face = "bold"),
        plot.subtitle = element_text(hjust=0.4, face = "italic", size = 10))
```

We plotted a map that shows the distribution of whale shark sightings surrounding the location of `Learmonth Airport`. The color of the points represents different seasons when the sightings occurred while the size of the points represent the number of sightings at a particular location. According to the plot, we can note that the most occurrences are in the spring season as they and they are also spread out across the coast. Next, highest occurrences are during winter season and then summer followed by fall. During winter, they appear towards north of the weather station and during summer they appear in south.

#### Finding The Relation Between Temperature and Sightings

**Profiling the Weather** Prior to performing the analysis for the correlation of sightings and weather, we would like to profile the weather condition around the learmonth aiport first. This will help us to get the preliminary understanding of how the condition around the area, which we will take as our ammunition to enhance the interpretation of our analysis.

```{r}
#| echo: false
#| warning: false
#| message: false

# Adding a new variable of average temperature
whale_shark_weather <- whale_shark_weather %>%
                        mutate(avg_temp = (tmax + tmin) / 2)

```


```{r}
#| label: fig-weathertrend
#| fig-cap: "Weather Trend"
#| fig-width: 10
#| fig-heigth: 10
#| echo: false
#| warning: false
#| message: false

# Trend of Rain Precipitation
p5 <- ggplot(narrogin_v2, aes(x = date)) +
        geom_point(aes(y = prcp)) +
        facet_wrap(~ month(date)) +
        ggtitle(label = "Rain Precipitation Trend") +
        theme_classic()

# Trend of Temperature (monthly)
p6 <- ggplot(narrogin_v2, aes(x = date)) +
        geom_point(aes(y = tmax), color = "red2") +
        geom_point(aes(y = tmin), color = "deepskyblue3") +
        facet_wrap(~ month(date)) +
        ggtitle(label = "Temperature Trend") +
        theme_classic()

grid.arrange(p5,p6, ncol = 2)  
```
<div style="background-color: #FFFFCC; padding: 10px;">

The `Learmonth Airport` vicinity predominantly __experiences arid conditions, evident from the near absence of precipitation throughout most of the year__, interspersed only by occasional bouts of rain. This region is also characterized by a vast temperature range: __temperatures as low as 3.5°C and soaring up to 48.9°C, showcasing a wide climatic amplitude__.

Referring to Figure @fig-weathertrend, __a striking observation is the pronounced uptick in rainfall frequency starting in January, which steadily intensifies before beginning to wane post-July, only to revert to sporadic showers for the remainder of the year__. 

Understanding these meteorological nuances affords us a richer lens to interpret the forthcoming correlation analyses. It equips us with the context to hypothesize why certain weather conditions might correlate with heightened whale shark sightings. Moving forward, this climatic backdrop will be juxtaposed against whale shark sightings, aiming to glean insights into their behavioral patterns in relation to the prevailing weather conditions.

<div>

> **Note:** This observation is centered around the frequency of the rain events, rather than their intensity - any non-zero precipitation is interpreted as rainfall. As for the temperature variations, they follow the anticipated seasonal fluctuations: scorching summers, chilly winters, with spring and autumn offering moderate climes.


**Whale Shark Sightings vs Temperature** We will start the analysis by unveiling the relationship between whale shark sightings against the average temperature. In the @fig-corrplot1 below, we grouped the observations based on the season to provide better visualisation and level of detail.

```{r}
#| label: fig-corrplot1
#| fig-cap: "Sightings to Avg. Temperature"
#| fig-width: 12
#| fig-heigth: 8
#| echo: false
#| warning: false
#| message: false

whale_shark_weather %>%
  filter(sighting == 1) %>%
  group_by(eventDate, season) %>%
  summarise(sightings = sum(sighting),
            avg_temp = mean(avg_temp)) %>%
  ggplot(aes(x = sightings, y = avg_temp, color = season)) +
    geom_point() +
    facet_wrap(~ season) +
    ggtitle(label = "Correlation of Sightings to Average Temperature",
            subtitle = "Around Learmonth Airport Weather Station") +
    xlab("Sightings") +
    ylab("Average Temperature (Celcius)") +
    theme_classic() +
    theme(plot.title = element_text(hjust=0.5, face = "bold"),
          plot.subtitle = element_text(hjust=0.5, face = "italic", size = 10))
```

<div style="background-color: #FFFFCC; padding: 10px;">
-   The above plot indicates that there's no clear relationship between temperature and whale shark sightings. While many species have specific temperature preferences, in this dataset, whale sharks don't seem to show a strong temperature-based behavior. This absence of correlation might imply that whale sharks either have a broad range of temperature tolerance or their migratory patterns aren't majorly influenced by local temperature shifts.
<div>

> **Note:**  It's essential to underscore that the temperatures in this dataset reflect atmospheric readings, which can diverge considerably from the sea water temperatures where whale sharks are often observed. A high atmospheric temperature, for instance, doesn't guarantee a corresponding warm sea temperature, and vice versa. The depth of sightings can further complicate this, as deeper marine environments are typically cooler. For a comprehensive understanding of the nexus between temperature and whale shark behavior, an integration of sea water temperature data is imperative. Currently, with just atmospheric temperature data at our disposal, drawing any definitive correlation between temperature and whale shark sightings remains elusive.

**Whale Shark Sightings vs Rain Precipitation** The next analysis will be the correlation analysis between sightings and rain precipitation. As known previously that the area is mostly dry, so this might be affecting the sightings as well. The plot will be similar as the previous analysis, where we grouped the observations based on the season to provide better visualisation and level of detail.

```{r}
#| label: fig-corrplot2
#| fig-cap: "Sightings to Rain Precipitation"
#| fig-width: 12
#| fig-heigth: 8
#| echo: false
#| warning: false
#| message: false

whale_shark_weather %>%
  filter(sighting == 1) %>%
  group_by(eventDate, season) %>%
  summarise(sightings = sum(sighting),
            prcp = mean(prcp)) %>%
  ggplot(aes(x = sightings, y = prcp, color = season)) +
    geom_point() +
    facet_wrap(~ season) +
    ggtitle(label = "Correlation of Sightings to Rain Precipitation",
            subtitle = "Around Learmonth Airport Weather Station") +
    xlab("Sightings") +
    ylab("Rain Precipitation") +
    theme_classic() +
    theme(plot.title = element_text(hjust=0.5, face = "bold"),
          plot.subtitle = element_text(hjust=0.5, face = "italic", size = 10))
```

<div style="background-color: #FFFFCC; padding: 10px;">
- The relationship between rain precipitation and whale shark sightings, as illustrated in @fig-corrplot2, predominantly showcases __the majority of sightings occurring during dry periods, although sightings during rainy periods are not absent__. Revisiting our observations from figure @fig-countoccur, we identified that the __peak sightings seasons for whale sharks are Winter and Spring__. 

Now, juxtaposing this with the weather profile in figure @fig-weathertrend, it __becomes evident that rain begins to mark its presence from January, steadily increasing through to July__. 

</div>

```{r}
#| echo: false
#| warning: false
#| message: false
cat("
<style>
.interesting {
  background-color: #e6f7ff; /* Light blue to signify importance */
  border-left: 5px solid #2196F3; /* Blue border to the left */
  padding: 10px;
  margin: 20px 0;
}
</style>
")

```

```{r}
cat("
<div class='interesting'>
This overlap sparks an intriguing hypothesis: could the rainfall indirectly catalyze a sequence of events leading to an influx of whale sharks in this region? Delving into research, we uncovered that rain does indeed play a pivotal role in shaping marine ecosystems. Rainfall increases land runoff which, upon merging with rivers, eventually flows into the sea. This influx often carries with it an abundance of nutrients, which can stimulate plankton growth. As these plankton proliferate, they become a food source for an array of marine creatures such as fish, crustaceans, and squids. Whale sharks, being apex feeders in this chain, thus indirectly benefit from this surge in food availability (Paczkowska et al., 2020). 

- In essence, while rainfall might not directly influence whale shark presence in a particular region, its cascading impact on the marine food web potentially creates conditions conducive for these gentle giants. Consequently, we can infer that an indirect correlation likely exists between rainfall patterns and whale shark sightings.
</div>
")

```


### Temporal analysis on tourism data


Tignostic analysis for tourism data to understand average trips taken by people to "Exmouth" for various reasons.

```{r}


tourism_shared <- highest_sightings %>%
  as_shared_tsibble(spec = (Purpose) / Region)

tourism_feat <- tourism_shared %>%
  features(total_trips, feat_stl)

p1 <- tourism_shared %>%
  ggplot(aes(x = year_quarter, y = total_trips)) +
  geom_line(aes(group = Region), alpha = 0.5) +
  facet_wrap(~ Purpose, scales = "free_y") 
p2 <- tourism_feat %>%
  ggplot(aes(x = trend_strength, y = seasonal_strength_year)) +
  geom_point(aes(group = Region))

  subplot(
    ggplotly(p1, tooltip = "Region", width = 700),
    ggplotly(p2, tooltip = "Purpose", width = 600),
    nrows = 2) %>%
  highlight(dynamic = FALSE)
```

The visualized analysis provides a comprehensive insight into the tourism trends in Exmouth, segmented by the purpose of visitation.

Tourism Over Time by Purpose:

The first graph displays the tourism trends in Exmouth across different quarters since 1998, stratified by the purpose of the visit.
One striking observation from this is the consistent rise in tourists visiting Exmouth for holidays. This increasing trend underscores Exmouth's growing appeal as a vacation destination.
While there are visitors coming to Exmouth for other reasons, such as business and visiting friends or relatives, their volume is relatively subdued when juxtaposed against the holidaymakers.

Seasonal versus Trend Strength:

The second graph contrasts the strength of the seasonal pattern against the trend for different regions.

Regions clustering together in this plot share similar seasonal and trend dynamics, making it an effective tool to understand patterns and anomalies at a glance.

Focusing on Exmouth, the analysis underscores its prominence as a holiday destination. The number of holiday tourists has been on a consistent uptick, underlining its allure. On the contrary, while there are other motivators bringing people to Exmouth, like business or visits to friends and family, their numbers pale in comparison to those coming for leisure. Hence, we will be focusing on "Holiday" data for further analysis.


```{r}
highest_sightings <- highest_sightings %>% filter(Purpose == 'Holiday')
```

#### Understanding tourism trends in our region of interest

```{r}
#| label: fig-tourismregion
#| fig-cap: "Total trips over night in Exmouth"
#| fig-width: 12
#| fig-heigth: 8
#| echo: false
#| warning: false
#| message: false
ggplot(highest_sightings, aes(x = year_quarter, y = total_trips)) +
  geom_line() +
  geom_point() +
  labs(title = "Total Trips Over Time",
       x = "Quarter",
       y = "Total trips") +
  theme_classic()
```


- We first start off by visualizing the overall tourist visits for each year in the Exmouth region. From the plot above, we gain two valuable insights. The first being that the average number of trips fluctuate frequently during a year which could be due to the quarter. The second one being that the peaks of the trips seems to be more in the second half of the plot. 

- But is this actually the case? Let's visualize the number of trips in a different way to see how the trips fared overall throughout the years.


```{r}
highest_sightings %>%
  index_by(year_quarter) %>%
  summarise(total_trips = mean(total_trips)) %>%
    mutate(quarter = substr(year_quarter, nchar(year_quarter), nchar(year_quarter) + 2),
         year = substr(year_quarter, nchar(year_quarter)-4, nchar(year_quarter) )) %>%
  ggplot(aes(x=year_quarter,y=total_trips)) +
  geom_line(aes(group=quarter,color=quarter)) +
              geom_smooth(se=FALSE) +
  labs(title = "Total Trips Over Time",
       x = "Year",
       y = "Total Trips") +
  theme_classic() +
  guides(color = "none")
```


As we can see from the above plot, the thick blue line does indicate that the overall tourist trips have increased over the years, especially after 2010. However, it we look at the quarter lines themselves, we notice that the teal colored line is way higher than the rest. Could this be due to the quarter being a either spring or winter where whale sharks are prominent as depicted  from our previous analysis on the sightings by seasons.

```{r}
highest_sightings %>%
  index_by(year_quarter) %>%
  summarise(total_trips = mean(total_trips)) %>%
    mutate(quarter = substr(year_quarter, nchar(year_quarter), nchar(year_quarter) + 2),
         year = substr(year_quarter, nchar(year_quarter)-4, nchar(year_quarter) )) %>%
  ggplot(aes(x=year_quarter,y=total_trips)) +
  geom_line(aes(group=quarter,color=quarter)) +
  facet_wrap(~quarter) +
  labs(title = "Total Trips Over Time By Quarter",   #Added Possible Analysis We could do for season-wise since each quarter is technically a season
       x = "Year",
       y = "Total Trips") +
  theme_classic() +
  guides(color = "none")
```


#### Analysing seasonal trend with forecasting

Trend Component:

The trend component reflects long-term progression in the time series data. It provides a smoothed version of the series where short-term fluctuations and seasonality are filtered out.

Seasonal Component:

This component captures the regular pattern caused by seasonal factors, which repeats over a specific period - in this case, quarterly, as the frequency is set to 4.

Remainder Component:

After the trend and seasonal components are extracted from the original series, what remains is the remainder (often referred to as the residual or irregular component). This component captures the random, irregular influences and potential outliers in the data.


```{r}
#| label: fig-seasonaltrend
#| fig-cap: "Seasonal and Trend Analysis Plot"
#| fig-width: 12
#| fig-heigth: 8
#| echo: false
#| warning: false
#| message: false

# Convert data to a ts object 
ts_data_trips <- ts(highest_sightings$total_trips, frequency=4)

# Decompose the time series for average trips
decomposition_trips <- stl(ts_data_trips, s.window="periodic")

# Plot the decomposition
autoplot(decomposition_trips) + labs(title = "Seasonal Decomposition of Total Trips")


```

However, we can observe from @fig-seasonaltrend that tourism in Exmouth exhibits significant seasonal patterns. According to information from other sources, the most suitable seasons for tourism are July and October. If you examine the weather plots @fig-weathertrend, you will notice that the region remains relatively mild even during the winter, allowing for various engaging outdoor activities such as swimming, marine life observation, and the wildflower season. These factors contribute to the highest number of tourists in Q3, followed by a slight decline in Q4. Q1, on the other hand, experiences a decrease in tourist activity, marking the off-peak season for tourism.

In recent years, there has been a rise in tourism in Exmouth. According to @fig-tourismregion and @fig-seasonaltrend, the overall trend shows a steady increase, with the peak observed after 2014 Q3 occurring in 2021 Q3. Additionally, we have noticed that the remainder plot fluctuation has become larger, indicating that non-seasonal factors play a significant role in the number of tourists. These factors may include promotional activities, local events, policy changes, or other tourism-related factors.

#### Trend analysis to understand number of people travelling to Exmouth for holidays.

```{r}
library(Kendall)

result <- trend::mk.test(highest_sightings$total_trips)

print(result)

```

**Analysis of the Mann-Kendall Test on the Time Series Data for Trips to Exmouth**:

After applying the Mann-Kendall test to our dataset for trips to Exmouth, we've obtained the following insights:

1. **z-value (2.7131)**: 
   - Our z-value is positive, which typically points to an increasing trend. The larger the absolute value of z, the stronger the trend. Here, 2.7131 indicates a notable increasing trend in our dataset.

2. **Sample Size (n = 100)**: 
   - We have used a considerable sample size of 100 data points, which grants more confidence in the statistical robustness of our results.

3. **Significance (p-value = 0.006666)**: 
   - The p-value is a fundamental measure in hypothesis testing. In our analysis, a p-value of 0.006666, which is considerably less than the 0.05 threshold, suggests that the trend we've observed in the data is statistically significant.

4. **Alternative Hypothesis**: 
   - Our test has been formulated around the hypothesis that the trend in the dataset (measured by S) isn't zero. Given our results, we have sufficient evidence to accept this alternative hypothesis.

5. **Sample Estimates**:
   - **S (912)**: 
     - The value of the S statistic further corroborates the upward trend in our dataset, given its positive value.
   - **Variance of S (varS = 112750)**: 
     - This measure gives us an idea about the dispersion or variability in our trend statistics.
   - **Tau (τ = 0.1842424)**: 
     - The Tau statistic, a type of correlation coefficient, confirms the increasing trend. Being a positive value (though not very close to 1), it suggests a moderately strong upward trend.

**Concluding Thoughts**: 

From our analysis, it's evident that there's a statistically significant increase in the number of trips to Exmouth over the time frame captured in the dataset. This trend underscores the potential growing interest of tourists in Exmouth, and as stewards of this region, it's crucial for us to understand and manage this growth responsibly.

However, while statistics provide a quantifiable measure, it's equally important to delve into qualitative aspects, external variables, and other factors that might influence this trend.

### Ecotourism

In Exmouth, there are various types of tourism available. Most of the visitors who come here are interested in having a closer interaction with nature. One of the most popular activities is swimming with whale sharks. These gentle giants are abundant in this region, making it a popular destination for people wanting to experience this unique adventure. Due to severe missing data before 2010, our focus is on 2010-2023.

```{r}
#| label: fig-compare
#| fig-cap: "The Relationship between Tourism and Whale Shark in Exmouth"
#| fig-width: 12
#| fig-heigth: 8
#| echo: false
#| warning: false
#| message: false

# Focus on whale sharks found in the Cape Range National Park area.
# Set the latitude and longitude range for Cape Range National Park within Exmouth.
whale_shark_Exmouth <- whale_shark %>% 
  filter(decimalLatitude < -21, decimalLatitude > -22.5,
         decimalLongitude > 113.5, decimalLongitude < 114.25) %>%
  filter(!is.na(eventDate) ) %>%
   mutate(year_quarter = yearquarter(eventDate)) %>%
  group_by(year_quarter) %>% 
  count()

# Merge the tourist travel data with the observed whale shark occurrence data within the range
exmouth <- left_join(highest_sightings, whale_shark_Exmouth, 
                             by = "year_quarter") 

# Focus on observing information from 2010 onwards 
# as there were almost no recorded whale shark sightings in the area before 2010, rendering any comparison non-comparable
exmouth_2010 <- exmouth %>%
  filter(as.Date(paste(substr(as.character(year_quarter), 1, 4),
                       "-01-01", sep = "")) >= as.Date("2010-01-01"))

# Turn all NA to 0 
exmouth_2010$n <- ifelse(is.na(exmouth_2010$n), 0, exmouth_2010$n)


# Combine a bar chart and a line chart to observe the trends between the two
exmouth_2010_plotly <- ggplot(exmouth_2010) +
  geom_area(aes(x = year_quarter, y = n, fill = "Occurrences (in thousand)", group = 1), alpha = 0.6) +
  geom_line(aes(x = year_quarter, y = total_trips, fill = "Trips", group = 1), alpha = 0.8) +
  labs(x = "Time (Quarterly)", 
       title = "The Relationship between Tourism and Whale Shark in Exmouth", 
       fill = "The number of") +
  scale_fill_manual(values = c("Occurrences (in thousand)" = "lightblue", "Trips" = "darkblue")) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ggplotly(exmouth_2010_plotly , tooltip = c("x", "y"))
```

In @fig-compare, we have combined the number of tourists and the number of whale sharks to observe the relationship between them visually. The strong relationship between the number of travelers and the sighting of a whale shark cannot be perfectly explained due to a few possible reasons. 

- Firstly, a whale shark sighting could be an attraction for travelers, but since the movement of wildlife is difficult to track, there is no guarantee that travelers will be able to see a whale shark every time they go out for it. 

- Secondly, the data coverage is not comprehensive enough, and the process of observing and recording whale sharks is not easy.

We have noticed a significant pattern for travelers in Exmouth, as previously mentioned in @fig-seasonaltrend. They tend to travel between Q2 - Q4, with the highest number of travelers in Q3 - the most important season for sightseeing. It's worth noting that 2021 was a successful year for tourism in Australia. Would the COVID-19 pandemic have a negative impact on tourism? However, in December 2020, Australia Government launched its COVID-19 vaccination program. People are more willing to travel after getting vaccinated. Additionally, the Australian Tourism Board's website outlines a [2021-2022 Australian Tourism Promotion Plan](https://www.transparency.gov.au/sites/default/files/reports/2021-22_corporate_plan_tourism_australia.pdf), which includes a range of promotional measures launched by the Australian government in 2021. These measures have also contributed to the growth of the Australian tourism industry.

In this section, we combine the weather, previous traveler information from @fig-compare, and Whale Shark data to determine if any correlations exist among them.

```{r}
# Calculate the weather information for the Ecotourism area
whale_shark_weather_exmouth <- narrogin %>%
  filter(!is.na(date)) %>%
  mutate(year_quarter = yearquarter(date)) %>%
  select(year_quarter, prcp, tmax, tmin) %>%
  group_by(year_quarter) %>%
  summarise(mean_prcp = mean(prcp, na.rm = TRUE),
            mean_tmax = mean(tmax, na.rm = TRUE),
            mean_tmin = mean(tmin, na.rm = TRUE),
            avg_temp = (mean_tmax + mean_tmin) / 2) %>%
  filter(as.Date(paste(substr(as.character(year_quarter), 1, 4),
                       "-01-01", sep = "")) >= as.Date("2010-01-01")) %>%
  mutate(quarter_group = case_when( 
    # We clustered together identical quarters to simplify subsequent analysis of their relationship.
    grepl("Q1", year_quarter) ~ 1,
    grepl("Q2", year_quarter) ~ 2,
    grepl("Q3", year_quarter) ~ 3,
    grepl("Q4", year_quarter) ~ 4,
    TRUE ~ NA_integer_
  )) 

# Transfer quarter into character
whale_shark_weather_exmouth$quarter_group <- as.character(whale_shark_weather_exmouth$quarter_group)


# Combine two dataset together
weather_tourism_exmouth_2010 <- left_join(exmouth_2010, 
                                          whale_shark_weather_exmouth, by = "year_quarter")
```

```{r}
ggpairs(weather_tourism_exmouth_2010, 
        columns = c("year_quarter", "total_trips", "avg_temp", "mean_prcp", "n"),
        mapping = aes(color = quarter_group),
        lower = list(continuous = "smooth"),
        upper = "blank",
        axisLabels = "show"
        ) %>%
    ggplotly()
```

In terms of weather, the average temperature of the place remains normal with seasonal variations. However, there are occasional higher temperature anomalies in rainfall, mostly in Q2. As for whale shark sightings, there has been a decline in recent years. On the other hand, the number of tourists visiting the place is increasing and shows seasonal distribution that corresponds with the average temperature. 

Based on the information provided, it is difficult to gather strong evidence supporting the correlation between weather conditions and the number of whale sharks or tourists. There are numerous factors that can affect the behavior of tourists, such as the season and individual travel preferences. It's challenging to attribute tourist behavior solely to one variable.

Based on our data, you can provide the following advice to ecotourists:

- **Best Time to Travel:** It is advisable for ecotourists to plan their trips during Q2 and Q4 when the weather is moderate and rainfall is lower, which is conducive to the development and observation of the ecosystem.

- **Marine Ecological Conservation:** Despite the decline in the number of whale shark sightings, it is still recommended for them to participate in whale shark watching activities that comply with conservation standards and to learn about protecting the marine ecosystem.

- **Sustainable Travel Choices:** Provide information about sustainable accommodation and travel options, and encourage them to choose eco-friendly accommodations and travel activities.

- **Preservation of Natural Resources:** Remind them to conserve energy and water resources during their trip and reduce their impact on the local environment to help preserve natural resources.

Through these suggestions, ecotourists can better understand how to respect and protect the ecological environment of the places they visit, while enjoying a meaningful and responsible travel experience.



```{r}
# Creating groups for mean_prcp
weather_tourism_exmouth_2010$mean_prcp_group <- cut(weather_tourism_exmouth_2010$mean_prcp, breaks=seq(0,max(weather_tourism_exmouth_2010$mean_prcp)+10, by=10), labels=FALSE, include.lowest = TRUE)
weather_tourism_exmouth_2010$mean_prcp_group <- paste((weather_tourism_exmouth_2010$mean_prcp_group-1)*10, weather_tourism_exmouth_2010$mean_prcp_group*10-1, sep="-")

# Printing the dataframe
print(weather_tourism_exmouth_2010)
```

```{r}

prcp_sighting <- ggplot(weather_tourism_exmouth_2010, aes(x = n, y = total_trips)) +
  geom_point(aes(color = mean_prcp_group), size=3, alpha=0.7) +
  facet_wrap(~ mean_prcp_group, scales="free", ncol=3) +
  labs(title = "Sighting vs Trips by Precipitation Group",
       x = "Sighting", y = "Trips") +
  theme_classic() 

ggplotly(prcp_sighting, tooltip = c("x", "y"))

```


The visual representation depicts the relationship between sightings, trips, and precipitation levels. A striking observation is that the majority of sightings and holiday trips coincide with periods of low rainfall, predominantly in the 0-20mm range. This suggests that tourists generally prefer conditions with minimal rainfall for their trips, and interestingly, the sightings also seem to be more prevalent during these times. It's essential to understand that just because these events happen concurrently doesn't necessarily mean one causes the other. The data, in its current form, hints that rainfall might not be a significant factor influencing both sightings and holiday trips. Both events might be happening independently of each other, driven by other factors not captured in this dataset.


## Summary

<div style="border: 2px solid black; padding: 10px; background-color: lightyellow; font-family: serif;">

💡💡

-   The data analysis showed that there were relatively even occurrences of whale shark sightings between spring and winter, with a slight edge for spring. Fall had a significant number of sightings, while summer had the fewest. This finding contradicted the expectation of higher occurrences during winter months.
-   The analysis using geospatial data confirmed that most whale shark sightings occurred in coastal areas rather than open ocean regions of Australia, aligning with the expectation of differences in habitat preferences.
-   Contrary to the expectation of declining occurrences, the data showed an increase in whale shark sightings from around 2008 to 2013, reaching a peak in 2013. Afterward, there was a decline, but it stabilized after 2017, suggesting that the population may have stabilized.
-   The analysis also suggested that whale sharks tend to prefer Western Australian waters, with a preference for winter months in the West and summer months in the East, indicating potential seasonal movement from west to east and vice versa.
-   The data confirmed the expectation of most occurrences in the northern part of Western Australia, particularly in the Ningaloo Marine Park area, which aligns with the known migration patterns and ecotourism activities in that region.
-   The correlation analysis between temperature whale shark sightings showed no significant pattern or dependency between them.
-   Similarly, the correlation analysis between rain precipitation and whale shark sightings suggest that rain precipitation did not directly affect sightings. But it was noted that frequent rainfall may indirectly impact sea ecosystems by promoting plankton growth, which could benefit whale sharks.

</div>

## References

Department of Fisheries, Government of Western Australia. (2011, September). Fisheries Fact Sheet: Whale Shark. https://www.fish.wa.gov.au/documents/recreational_fishing/fact_sheets/fact_sheet_whale_shark.pdf

McGrouther, Mark. (2022, October). Whale Shark, Rhincodon typus (Smith, 1828). Australian Museum. https://australian.museum/learn/animals/fishes/whale-shark-rhincodon-typus-smith-1828/

Britannica. (2023, August). Whale Shark. Britannica. https://www.britannica.com/animal/whale-shark

French, C.J. 2006. Australia's Maritime Zones/Boundaries Map. Geoscience Australia, Canberra. https://pid.geoscience.gov.au/dataset/ga/63690

Australian Bureau of Statistics. (2021, July). Digital Boundary Files. https://www.abs.gov.au/statistics/standards/australian-statistical-geography-standard-asgs-edition-3/jul2021-jun2026/access-and-downloads/digital-boundary-files

Bowie, A. (n.d.). Best time to visit Ningaloo Reef. Honeymoon Guide. Retrieved October 5, 2023, from https://www.honeymoonguide.com.au/australia/ningaloo-reef-weather.html#:\~:text=Note%3A%20Meteorological%20data%20for%20the%20Ningaloo%20Coast%20is

Paczkowska, J., Brügel, S., Rowe, O., Lefèbure, R., Brutemark, A., & Andersson, A. (2020). Response of coastal phytoplankton to high inflows of terrestrial matter. Frontiers in Marine Science, 7. https://doi.org/10.3389/fmars.2020.00080

The following are the R-packages used in this blog-post:

-   **tidyverse**: Wickham H, Averick M, Bryan J, Chang W, McGowan LD, François R, Grolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL, Miller E, Bache SM, Müller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi K, Vaughan D, Wilke C, Woo K, Yutani H (2019). "Welcome to the tidyverse." *Journal of Open Source Software*, *4*(43), 1686. doi:10.21105/joss.01686 <https://doi.org/10.21105/joss.01686>.

-   **dplyr**: Wickham H, François R, Henry L, Müller K, Vaughan D (2023). *dplyr: A Grammar of Data Manipulation*. R package version 1.1.1, <https://CRAN.R-project.org/package=dplyr>.

-   **ggplot2**: H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York, 2016.

-   **sf**: Pebesma, E., & Bivand, R. (2023). Spatial Data Science: With Applications in R. Chapman and Hall/CRC. https://doi.org/10.1201/9780429459016

-   **here**: Müller K (2020). *here: A Simpler Way to Find Your Files*. R package version 1.0.1, <https://CRAN.R-project.org/package=here>.

-   **galah**: Westgate M, Kellie D, Stevenson M, Newman P (2023). *galah: Biodiversity Data from the Living Atlas Community*. R package version 1.5.3, <https://CRAN.R-project.org/package=galah>.

-   **visdat**: Tierney N (2017). "visdat: Visualising Whole Data Frames." *JOSS*, *2*(16), 355. doi:10.21105/joss.00355 <https://doi.org/10.21105/joss.00355>, <http://dx.doi.org/10.21105/joss.00355>.

-   **leaflet**: Cheng J, Schloerke B, Karambelkar B, Xie Y (2023). *leaflet: Create Interactive Web Maps with the JavaScript 'Leaflet' Library*. R package version 2.2.0, <https://CRAN.R-project.org/package=leaflet>.

-   **rnoaa**: Chamberlain S, Hocking D (2023). *rnoaa: 'NOAA' Weather Data from R*. R package version 1.4.0, <https://CRAN.R-project.org/package=rnoaa>.

-   **gridExtra**: Auguie B (2017). *gridExtra: Miscellaneous Functions for "Grid" Graphics*. R package version 2.3, <https://CRAN.R-project.org/package=gridExtra>.

-   **rworlddmap**: South, Andy 2011 rworldmap: A New R package for Mapping Global Data. The R Journal Vol. 3/1 : 35-43.

-   **tsibble**: Wang, E, D Cook, and RJ Hyndman (2020). A new tidy data structure to support exploration and modeling of temporal data, Journal of Computational and Graphical Statistics, 29:3, 466-478, doi:10.1080/10618600.2019.1695624.

-   **lubridate**:  Garrett Grolemund, Hadley Wickham (2011). Dates and Times Made Easy with lubridate. 

-   **rmapshaper**:  Teucher A, Russell K (2023). _rmapshaper: Client for 'mapshaper' for 'Geospatial' Operations_. R package version 0.5.0, <https://CRAN.R-project.org/package=rmapshaper>.

-   **zoo**: eileis A, Grothendieck G (2005). “zoo: S3 Infrastructure for Regular and Irregular Time Series.” _Journal of Statistical Software_, *14*(6), 1-27. doi:10.18637/jss.v014.i06
  <https://doi.org/10.18637/jss.v014.i06>.

-   **tsibbletalk**: Wang E, Cook D (2020). _tsibbletalk: Interactive Graphics for Tsibble Objects_. R package version 0.1.0, <https://CRAN.R-project.org/package=tsibbletalk>.

-   **feasts**: O'Hara-Wild M, Hyndman R, Wang E (2023). _feasts: Feature Extraction and Statistics for Time Series_. R package version 0.3.1, <https://CRAN.R-project.org/package=feasts>.

-   **plotly**:  C. Sievert. Interactive Web-Based Data Visualization with R, plotly, and shiny. Chapman and Hall/CRC Florida, 2020.

-   **tibble**: Müller K, Wickham H (2023). _tibble: Simple Data Frames_. R package version 3.2.1, <https://CRAN.R-project.org/package=tibble>.

-   **forecast**: Hyndman R, Athanasopoulos G, Bergmeir C, Caceres G, Chhay L, O'Hara-Wild M, Petropoulos F, Razbash S, Wang E, Yasmeen F (2023). _forecast: Forecasting functions for time series and linear models_. R package version 8.21, <https://pkg.robjhyndman.com/forecast/>.

Hyndman RJ, Khandakar Y (2008). “Automatic time series forecasting: the forecast package for R.” _Journal of Statistical Software_, *26*(3), 1-22. doi:10.18637/jss.v027.i03 <https://doi.org/10.18637/jss.v027.i03>.

-   **GGally**:   Schloerke B, Cook D, Larmarange J, Briatte F, Marbach M, Thoen E, Elberg A, Crowley J (2021). _GGally: Extension to 'ggplot2'_. R package version 2.1.2,
  <https://CRAN.R-project.org/package=GGally>.
:::
